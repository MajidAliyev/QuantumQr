{% extends 'base.html' %}

{% block title %}{{ qr.name }} - QuantumQR{% endblock %}

{% block content %}
<div class="mb-6">
    <a href="{% url 'dashboard' %}" class="text-blue-600 hover:underline">‚Üê Back to Dashboard</a>
</div>

<h1 class="text-3xl font-bold mb-6">{{ qr.name }}</h1>

<div class="grid md:grid-cols-2 gap-8">
    <!-- QR Code Image -->
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-bold mb-4">QR Code</h3>
        <div class="flex justify-center mb-4">
            <img src="data:image/png;base64,{{ qr_image_data }}" alt="QR Code" class="border-4 border-gray-300">
        </div>
        
        <!-- Download Options -->
        <div class="grid grid-cols-3 gap-2">
            <a href="{% url 'download-qr' qr.pk 'png' %}" 
               class="bg-blue-600 hover:bg-blue-700 text-white text-center py-2 px-4 rounded transition">
                PNG
            </a>
            <a href="{% url 'download-qr' qr.pk 'svg' %}" 
               class="bg-green-600 hover:bg-green-700 text-white text-center py-2 px-4 rounded transition">
                SVG
            </a>
            <a href="{% url 'download-qr' qr.pk 'pdf' %}" 
               class="bg-red-600 hover:bg-red-700 text-white text-center py-2 px-4 rounded transition">
                PDF
            </a>
        </div>
    </div>
    
    <!-- Details -->
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-bold mb-4">Details</h3>
        
        <div class="space-y-3">
            <div>
                <span class="font-semibold">Type:</span>
                <span class="px-2 py-1 text-xs rounded {% if qr.qr_type == 'dynamic' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ qr.qr_type|capfirst }}
                </span>
            </div>
            
            <div>
                <span class="font-semibold">Scans:</span> {{ scan_count }}
            </div>
            
            <div>
                <span class="font-semibold">Size:</span> {{ qr.size }}px
            </div>
            
            <div>
                <span class="font-semibold">Error Correction:</span> {{ qr.get_error_correction_display }}
            </div>
            
            <div>
                <span class="font-semibold">Created:</span> {{ qr.created_at|date:"M d, Y H:i" }}
            </div>
            
            {% if qr.qr_type == 'dynamic' %}
                <div class="bg-blue-50 p-4 rounded-lg">
                    <span class="font-semibold block mb-2">QR Code URL:</span>
                    <input type="text" id="qr-url" value="{{ request.scheme }}://{{ request.get_host }}/redirect/{{ qr.short_url }}/" 
                           class="w-full px-3 py-2 border border-blue-300 rounded font-mono text-sm" readonly>
                    <button onclick="copyToClipboard('qr-url')" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                        üìã Copy URL
                    </button>
                </div>
                
                <div>
                    <span class="font-semibold">Destination:</span>
                    <div id="destination-display">
                        {% include 'partials/url_display.html' with qr=qr %}
                    </div>
                    <button onclick="showUpdateForm()" class="mt-2 text-blue-600 hover:underline">
                        Update URL
                    </button>
                </div>
            {% endif %}
        </div>
        
        <div class="mt-6 space-x-2">
            <a href="{% url 'qr-analytics' qr.pk %}" 
               class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition">
                View Analytics
            </a>
            <a href="{% url 'delete-qr' qr.pk %}" 
               class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition"
               onclick="return confirm('Are you sure you want to delete this QR code?')">
                Delete
            </a>
        </div>
    </div>
</div>

{% if qr.qr_type == 'dynamic' %}
<div id="update-form-container" style="display:none;" class="mt-6 bg-white p-6 rounded-lg shadow-lg">
    <h3 class="text-xl font-bold mb-4">Update Destination URL</h3>
    <form hx-post="{% url 'update-url' qr.pk %}" hx-target="#destination-display" hx-swap="innerHTML">
        {% csrf_token %}
        <div class="mb-4">
            <input type="url" name="destination_url" value="{{ qr.destination_url }}" required
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg">
        </div>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
            Update
        </button>
        <button type="button" onclick="hideUpdateForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded ml-2">
            Cancel
        </button>
    </form>
</div>

<script>
function showUpdateForm() {
    document.getElementById('update-form-container').style.display = 'block';
}

function hideUpdateForm() {
    document.getElementById('update-form-container').style.display = 'none';
}

function copyToClipboard(inputId) {
    const input = document.getElementById(inputId);
    input.select();
    input.setSelectionRange(0, 99999); // For mobile devices
    document.execCommand('copy');
    alert('URL copied to clipboard!');
}
</script>
{% endif %}
{% endblock %}

